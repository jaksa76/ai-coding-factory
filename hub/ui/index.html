<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Coding Factory Hub – Tasks</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --bg: #f7f8fa;
            --card: #ffffff;
            --text: #172b4d;
            --muted: #6b778c;
            --border: #e6e8ea;
            --primary: #0052cc; /* Atlassian blue vibe */
            --primary-600: #0747a6;
            --success-bg: #e3fcef;
            --success-text: #006644;
            --error-bg: #ffebe6;
            --error-text: #bf2600;
            --warning-bg: #fffae6;
            --warning-text: #974f0c;
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            color: var(--text);
            background: var(--bg);
        }

        /* Top header */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--card);
            border-bottom: 1px solid var(--border);
        }
        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
            gap: 16px;
        }
        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        .brand-mark {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: var(--primary);
            box-shadow: inset 0 -6px 12px rgba(0,0,0,0.15);
        }
        .brand-name { color: var(--text); }

        .page {
            max-width: 1200px;
            margin: 24px auto;
            padding: 0 20px 40px;
        }

        .page-title { font-size: 22px; margin-bottom: 16px; }

        /* Controls */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .toolbar-left, .toolbar-right { display: flex; gap: 8px; align-items: center; }

        .btn {
            appearance: none;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 120ms ease, border-color 120ms ease, box-shadow 120ms ease;
        }
        .btn:hover { background: #f4f5f7; }
        .btn:active { transform: translateY(0.5px); }
        .btn.primary {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }
        .btn.primary:hover { background: var(--primary-600); border-color: var(--primary-600); }
        .btn.danger { border-color: #ffbdad; color: #de350b; }

        .btn.icon { padding: 6px 8px; }
        .btn .fa { font-size: 14px; }
        .btn .btn-text { margin-left: 6px; }

        .input, .select {
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 14px;
            color: var(--text);
        }

        /* Card */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 1px 2px rgba(9,30,66,0.08);
            padding: 16px;
        }

        .message { margin-bottom: 12px; }
        .msg { padding: 10px 12px; border-radius: 8px; font-size: 14px; }
        .msg.success { background: var(--success-bg); color: var(--success-text); border: 1px solid #b3dfc3; }
        .msg.error { background: var(--error-bg); color: var(--error-text); border: 1px solid #ffd2cc; }

        /* Task form */
        .task-form { display: none; margin-bottom: 12px; padding: 16px; background: #fafbfc; border: 1px solid var(--border); border-radius: 8px; }
        .form-row { display: grid; gap: 10px; }
        .form-actions { display: flex; gap: 8px; margin-top: 8px; }
        textarea { resize: vertical; min-height: 96px; }

        /* Table */
        .table-wrapper { overflow-x: auto; background: var(--card); border: 1px solid var(--border); border-radius: 10px; box-shadow: 0 1px 2px rgba(9,30,66,0.08); }
        table.table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .table thead th { text-align: left; font-weight: 600; font-size: 12px; color: var(--muted); background: #fafbfc; border-bottom: 1px solid var(--border); padding: 10px 12px; }
        .table tbody td { padding: 12px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .table tbody tr:hover { background: #f8f9fb; }
        .col-id { width: 220px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 12px; color: var(--muted); }
        .col-status { width: 140px; }
        .col-desc { min-width: 300px; }
        .col-actions { width: 160px; text-align: right; }

        .status { font-size: 12px; font-weight: 600; text-transform: uppercase; padding: 2px 8px; border-radius: 999px; display: inline-block; }
        .st-pending { background: #ebecf0; color: #42526e; }
        .st-in-progress { background: #deebff; color: #0747a6; }
        .st-completed { background: #e3fcef; color: #006644; }
        .st-failed { background: #ffebe6; color: #bf2600; }
        .desc { color: var(--text); line-height: 1.5; }
        .actions { display: inline-flex; gap: 6px; }

        .loading, .empty { text-align: center; color: var(--muted); padding: 24px; }

        @media (max-width: 720px) {
            .task-main { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-inner">
            <div class="brand">
                <div class="brand-mark" aria-hidden="true"></div>
                <div class="brand-name">AI Coding Factory Hub</div>
            </div>
        </div>
    </header>

    <main class="page">
        <h1 class="page-title">Tasks</h1>

        <div id="message" class="message"></div>

        <div class="toolbar">
            <div class="toolbar-left">
                    <button class="btn primary" id="btnAdd" title="Add task"><i class="fa fa-plus" aria-hidden="true"></i><span class="btn-text">Add task</span></button>
                    <button class="btn" id="btnRefresh" title="Refresh"><i class="fa fa-rotate-right" aria-hidden="true"></i><span class="btn-text">Refresh</span></button>
            </div>
            <div class="toolbar-right">
                <input class="input" id="search" placeholder="Search tasks" />
                <select class="select" id="statusFilter">
                    <option value="">All statuses</option>
                    <option value="pending">Pending</option>
                    <option value="in-progress">In progress</option>
                    <option value="completed">Completed</option>
                    <option value="failed">Failed</option>
                </select>
            </div>
        </div>

        <section class="task-form" id="taskForm">
            <div class="form-row">
                <label for="taskDescription" style="font-weight:600;">Description</label>
                <textarea class="input" id="taskDescription" placeholder="Describe the task…"></textarea>
            </div>
            <div class="form-actions">
                    <button class="btn primary" id="btnCreate" title="Create task"><i class="fa fa-check" aria-hidden="true"></i><span class="btn-text">Create task</span></button>
                    <button class="btn" id="btnCancel" title="Cancel"><i class="fa fa-xmark" aria-hidden="true"></i><span class="btn-text">Cancel</span></button>
            </div>
        </section>

            <section class="card">
                <div id="tasks">
                    <div class="loading">Loading tasks…</div>
                </div>
            </section>
    </main>

    <script>
        const API_BASE = '/api/tasks';
        let tasks = [];
        let filtered = [];

        const els = {
            msg: document.getElementById('message'),
            form: document.getElementById('taskForm'),
            desc: document.getElementById('taskDescription'),
            tasks: document.getElementById('tasks'),
            search: document.getElementById('search'),
            filter: document.getElementById('statusFilter'),
            btnAdd: document.getElementById('btnAdd'),
            btnRefresh: document.getElementById('btnRefresh'),
            btnCreate: document.getElementById('btnCreate'),
            btnCancel: document.getElementById('btnCancel'),
        };

        function showMsg(text, type = 'success') {
            els.msg.innerHTML = `<div class="msg ${type === 'error' ? 'error' : 'success'}">${escapeHtml(text)}</div>`;
            setTimeout(() => els.msg.innerHTML = '', 4000);
        }

        function toggleForm(show) {
            const visible = show ?? (els.form.style.display !== 'block');
            els.form.style.display = visible ? 'block' : 'none';
            if (visible) els.desc.focus(); else els.desc.value = '';
        }

        async function load() {
            els.tasks.innerHTML = '<div class="loading">Loading tasks…</div>';
            try {
                const res = await fetch(API_BASE);
                if (!res.ok) throw new Error('Failed to load');
                tasks = await res.json();
                applyFilter();
            } catch (e) {
                els.tasks.innerHTML = '<div class="empty">Could not load tasks.</div>';
            }
        }

        async function createTask() {
            const description = els.desc.value.trim();
            if (!description) { showMsg('Please enter a description.', 'error'); return; }
            try {
                const res = await fetch(API_BASE, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ description }) });
                if (!res.ok) throw new Error('Create failed');
                const t = await res.json();
                tasks.unshift(t);
                applyFilter();
                toggleForm(false);
                showMsg('Task created');
            } catch (e) {
                showMsg('Failed to create task', 'error');
            }
        }

        async function updateStatus(id, status) {
            try {
                const res = await fetch(`${API_BASE}/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ status }) });
                if (!res.ok) throw new Error('Update failed');
                const updated = await res.json();
                const idx = tasks.findIndex(t => t.id === id);
                if (idx !== -1) tasks[idx] = updated;
                applyFilter();
                showMsg(`Status updated to ${status}`);
            } catch (e) {
                showMsg('Failed to update status', 'error');
            }
        }

        async function removeTask(id) {
            if (!confirm('Delete this task?')) return;
            try {
                const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('Delete failed');
                tasks = tasks.filter(t => t.id !== id);
                applyFilter();
                showMsg('Task deleted');
            } catch (e) {
                showMsg('Failed to delete task', 'error');
            }
        }

        function applyFilter() {
            const q = els.search.value.trim().toLowerCase();
            const st = els.filter.value;
            filtered = tasks.filter(t => {
                const matchesQ = !q || t.description?.toLowerCase().includes(q) || t.id.toLowerCase().includes(q);
                const matchesS = !st || t.status === st;
                return matchesQ && matchesS;
            });
            render();
        }

            function render() {
                if (!filtered.length) {
                    els.tasks.innerHTML = tasks.length
                        ? '<div class="empty">No tasks match your filters.</div>'
                        : '<div class="empty">No tasks yet. Create your first task.</div>';
                    return;
                }
                const rows = filtered.map(t => `
                    <tr>
                        <td class="col-id">${escapeHtml(t.id)}</td>
                        <td class="col-status"><span class="status st-${t.status}">${escapeHtml(t.status)}</span></td>
                        <td class="col-desc desc">${escapeHtml(t.description || '')}</td>
                        <td class="col-actions">
                            <div class="actions">
                                ${t.status === 'pending' ? `<button class="btn icon" title="Start" aria-label="Start" onclick="updateStatus('${t.id}','in-progress')"><i class='fa fa-play' aria-hidden='true'></i></button>` : ''}
                                ${t.status === 'in-progress' ? `<button class="btn icon" title="Pause" aria-label="Pause" onclick="updateStatus('${t.id}','pending')"><i class='fa fa-pause' aria-hidden='true'></i></button>` : ''}
                                <button class="btn icon danger" title="Delete" aria-label="Delete" onclick="removeTask('${t.id}')"><i class='fa fa-trash' aria-hidden='true'></i></button>
                            </div>
                        </td>
                    </tr>
                `).join('');

                els.tasks.innerHTML = `
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Task ID</th>
                                <th>Status</th>
                                <th>Description</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>
                </div>`;
            }

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = String(str ?? '');
            return div.innerHTML;
        }

        // Events
        els.btnAdd.addEventListener('click', () => toggleForm());
        els.btnRefresh.addEventListener('click', load);
        els.btnCreate.addEventListener('click', createTask);
        els.btnCancel.addEventListener('click', () => toggleForm(false));
        els.search.addEventListener('input', applyFilter);
        els.filter.addEventListener('change', applyFilter);

        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n') {
                e.preventDefault();
                toggleForm(true);
            }
            if (e.key === 'Escape' && els.form.style.display === 'block') toggleForm(false);
        });

        // Init
        load();
    </script>
</body>
</html>
